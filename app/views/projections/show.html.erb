<div class="banner banner-smaller" style="background-image: linear-gradient(-225deg, rgba(168, 132, 0, 0.31) 0%, rgba(61, 21, 0, 0.2) 50%), url(<%= image_path 'rooftop_projection.jpg' %>);"></div>
  <div class="container">
    <div class="row" id="projection">
      <div class="col-xs-12 col-sm-2 col-sm-offset-1 text-center">
        <% if @projection.photo? %>
          <%= cl_image_tag @projection.photo.path, width: 160, height: 240, crop: :fill, id: "margin-image" %>
        <% end %>
        <br>
        <%= link_to "Get a ticket", "#", class: "btn btn-underline" %>
      </div>
      <div class="col-xs-12 col-sm-8">
        <h2><%= @projection.name %></h2>
        <h4>Address: <%= @projection.address %></h4>
        <% if current_user == @projection.user %>
          <%= link_to "Edit", edit_projection_path(@projection) %>
        <% end %>
        <br>
        <%= link_to "< All projections", projections_path %>
          <p><%= Date::ABBR_MONTHNAMES[@projection.date.month] %></p>
          <p class="movie-date"><%= @projection.date.day %></p>
        <h4>Capacity: <%= @projection.capacity %></h4>
        <h4>Places restantes: <%= @projection.capacity - @projection.bookings.length %></h4>
        <div style="display: flex; flex-direction: row, justify-content: flex-start">
          <h4>
            Participants:
            <% @projection.bookings.each do |booking| %>
              <%= booking.user.first_name + " " + booking.user.last_name %>
            <% end %>
          </h4>
        </div>
        <h4>Organizer: <%= @projection.user.first_name %></h4>

        <ul>
          <% if user_signed_in? %>
            <% if (@projection.reviews & current_user.reviews).empty? && !(@projection.bookings & current_user.bookings).empty? %>
              <li>
                <%= simple_form_for @new_review do |f| %>
                  <%= f.error_notification %>
                  <% @booking = Booking.where(user: current_user, projection: @projection).first %>
                  <%= f.input :booking_id, as: :hidden, input_html: { value: @booking.id } %>
                  <%= f.input :content %>
                  <%= f.input :rating %>
                  <%= f.button :submit, "Review" %>
                <% end %>
              </li>
            <% end %>
          <% end %>
          <% @reviews.each do |review| %>
            <li>
              <ul>
                <li><%= review.booking.user.first_name + " " + review.booking.user.last_name %></li>
                <li><%= review.created_at %></li>
                <% if user_signed_in? && review.booking.user == current_user %>
                  <li>
                    <%= simple_form_for review do |f| %>
                      <%= f.error_notification %>
                      <%= f.input :id, as: :hidden, input_html: { value: review.id } %>
                      <% @booking = Booking.where(user: current_user, projection: @projection).first %>
                      <%= f.input :booking_id, as: :hidden, input_html: { value: @booking.id } %>
                      <%= f.input :content %>
                      <%= f.input :rating %>
                      <%= f.button :submit, "Edit review" %>
                    <% end %>
                  </li>
                <% else %>
                  <li><%= review.content %></li>
                  <li><%= "X" * review.rating %></li>
                <% end %>
              </ul>
              </br>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
